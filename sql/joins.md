Для начала создадим две таблицы с которыми будем работать:
```
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    city VARCHAR(100)
);
```
```
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id),
    product VARCHAR(100),
    amount INT
);
```
```
-- Пользователи
INSERT INTO users (name, city) VALUES
('Анна', 'Москва'),
('Иван', 'Санкт-Петербург'),
('Мария', 'Казань'),
('Сергей', 'Новосибирск'),
('Ольга', 'Москва'),
('Дмитрий', 'Екатеринбург');

-- Заказы
INSERT INTO orders (user_id, product, amount) VALUES
(1, 'Ноутбук', 1),
(1, 'Мышь', 2),
(2, 'Клавиатура', 1),
(3, 'Монитор', 1),
(3, 'Наушники', 1),
(5, 'Коврик для мыши', 1);
```
PostgreSQL JOINS используется для извлечения данных из нескольких таблиц. PostgreSQL JOIN выполняется всякий раз, когда две или более таблицы объединяются в операторе SQL.  
Существуют разные типы соединений PostgreSQL:
# `INNER JOIN` — только совпадения
```
SELECT users.name, orders.product
FROM users
INNER JOIN orders ON users.id = orders.user_id;
```
Что делает:
- Берёт **только те строки, где `users.id = orders.user_id`**
    
- Игнорирует всё, что не совпало

# `LEFT JOIN` — все из `users`, заказы если есть
```
SELECT users.name, orders.product
FROM users
LEFT JOIN orders ON users.id = orders.user_id;
```
Что делает:
- Показывает **всех пользователей**
    
- Добавляет к ним заказы, если есть
    
- Если заказов нет — ставит `NULL`

# `RIGHT JOIN` — все из `orders`, пользователей если есть
```
SELECT users.name, orders.product
FROM users
RIGHT JOIN orders ON users.id = orders.user_id;
```
Что делает:
- Показывает **все заказы**
    
- Добавляет к ним пользователя, если есть
    
- Если пользователя нет — `NULL`

# `FULL OUTER JOIN` — всё со всех сторон
```
SELECT users.name, orders.product
FROM users
FULL OUTER JOIN orders ON users.id = orders.user_id;
```
Что делает:
- Показывает **всех пользователей и все заказы**
    
- Если нет пары — вставляет `NULL`

# `CROSS JOIN` — все со всеми
```
SELECT users.name, orders.product
FROM users
CROSS JOIN orders;
```
Что делает:
- **Не смотрит на связи вообще**
    
- Каждая строка из `users` соединяется с каждой строкой из `orders`

![[Pasted image 20250604152016.png]]

# Практика
1. **INNER JOIN**  
    Вывести имена пользователей и названия товаров, которые они заказали.
    
2. **LEFT JOIN**  
    Вывести всех пользователей и соответствующие заказы, если они есть (если заказов нет — NULL).
    
3. **RIGHT JOIN**  
    Вывести все заказы и имена пользователей, которые их сделали. Если пользователь не найден — вывести NULL.
    
4. **FULL OUTER JOIN**  
    Вывести всех пользователей и все заказы, включая тех пользователей, у которых нет заказов, и заказы, у которых нет пользователей.
    
5. **CROSS JOIN**  
    Вывести все возможные пары "пользователь — товар".
    
6. **LEFT JOIN + фильтр по NULL**  
    Вывести имена пользователей, у которых **нет заказов**.
    
7. **INNER JOIN с условием**  
    Вывести пользователей и заказы, у которых сумма заказа больше 100.
    
8. **JOIN с агрегацией**  
    Для каждого пользователя вывести имя и количество заказов (используя LEFT JOIN, чтобы показать пользователей без заказов).
    
9. **JOIN с сортировкой**  
    Вывести имена пользователей и название их товаров, отсортированные по имени пользователя в алфавитном порядке.
    
10. **INNER JOIN с группировкой по товару**  
    Вывести название товара и общее количество заказов этого товара (учитывая, что у одного пользователя может быть несколько заказов одного товара).