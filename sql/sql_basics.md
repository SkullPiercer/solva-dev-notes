### **Подготовка данных под задачу**

Чтобы приступить к работе с базой данных, сначала нужно создать саму базу и таблицы, в которых будут храниться данные. Для этого применяются команды `CREATE DATABASE` и `CREATE TABLE`. Если нужно удалить базу или таблицу, используются команды `DROP DATABASE` и `DROP TABLE`. Каждое SQL-выражение завершается точкой с запятой `;`, что указывает на окончание команды.

### **Создание таблиц: структура и синтаксис**

Когда мы создаём таблицу в базе данных, сначала указывается её имя, а затем — в круглых скобках — перечисляются поля (столбцы), их типы данных, ограничения и дополнительные атрибуты. Все параметры разделяются запятыми. Также на этом этапе указываются ключи — например, первичный.

Рассмотрим пример для проекта, в котором мы храним данные пользователей:
```
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    phone_number VARCHAR(20)
);
```
Здесь происходит следующее:
- `users` — имя таблицы, в которой будут храниться данные о пользователях.
    
- `id` — уникальный идентификатор для каждой записи. Тип `SERIAL` автоматически создаёт последовательные значения. Это поле одновременно:
    
    - первичный ключ (`PRIMARY KEY`),
        
    - автоинкрементируемое (значение увеличивается с каждой новой записью).
        
- `name` — текстовое поле длиной до 100 символов. Атрибут `NOT NULL` означает, что имя обязательно должно быть указано.
    
- `phone_number` — поле для хранения номера телефона, допускает строки длиной до 20 символов.

Так создаётся основа для хранения данных пользователей в любом типичном проекте — от административной панели до CRM-системы.

### **Добавление данных в таблицу**

После того как структура таблицы создана, следующим шагом идёт наполнение её записями. Для этого используется команда `INSERT INTO`, с помощью которой можно добавлять одну или несколько строк данных.

Допустим, мы хотим внести в таблицу `Users нового пользователя:
```
INSERT INTO "User" (name, phone_number)
VALUES ('Ирина Соколова', '+7-999-123-45-67');
```
Здесь:
- `INSERT INTO users` — указывает, в какую таблицу добавляем данные;
    
- в скобках перечисляются имена столбцов, в которые будет производиться вставка;
    
- после ключевого слова `VALUES` передаётся набор значений в том же порядке, в каком указаны столбцы.

Поле `id` здесь не указывается, так как оно создаётся автоматически благодаря типу `SERIAL`.

Можно добавить сразу несколько записей за один запрос:
```
INSERT INTO "User" (name, phone_number)
VALUES 
  ('Андрей Смирнов', '+7-999-222-33-44'),
  ('Мария Иванова', '+7-999-555-66-77');
```
Такой подход полезен, когда нужно массово наполнить таблицу начальными данными — например, при загрузке тестовой информации в dev-среду или при первичном импорте.

Для проверки используем команду:
```
SELECT *
FROM "User";
```

Так же мы можем получить отдельный набор атрибутов, для этого указываем их вместо звездочки:
```
SELECT phone_number
FROM "User";
```

Команда `UPDATE` используется для изменения существующих данных в таблице. Она позволяет обновить значения одного или нескольких столбцов в одной или нескольких строках, удовлетворяющих заданному условию.

Общий синтаксис:
```
UPDATE table_name
SET column1 = value1,
    column2 = value2,
    ...
WHERE condition;
```

- `table_name` — имя таблицы, в которой обновляются данные;
    
- `SET` — указывает столбцы и новые значения, которые должны быть записаны;
    
- `WHERE` — условие, определяющее, какие строки нужно изменить (если его не указать — изменятся _все_ строки таблицы).

Допустим, нам нужно обновить номер телефона пользователя по имени:
```
UPDATE users
SET phone_number = '+7-999-000-00-00'
WHERE name = 'Ирина Соколова';
```
В этом запросе:

- в таблице `users` будет найден пользователь с именем `Ирина Соколова`,
    
- и у него обновится поле `phone_number`.
Идентификаторы обычно уникальны, и обновление по `id` считается лучшей практикой:

```
UPDATE users
SET name = 'Ирина Петрова'
WHERE id = 1;
```
### **Массовое обновление**
Можно обновить сразу несколько строк по определённому условию:
```
UPDATE users
SET phone_number = NULL
WHERE phone_number LIKE '+7-999%';
```

## **Удаление данных: `DELETE`**

Команда `DELETE` применяется, когда нужно убрать одну или несколько строк из таблицы. Если ты работаешь с таблицей `"User"`, не забывай использовать двойные кавычки.

### **Пример:**
Удалим пользователя по имени:
```
DELETE FROM "User"
WHERE name = 'Мария Иванова';
```
- Если не указать `WHERE`, будут удалены **все строки** в таблице.
    
- Удаление — это транзакционная операция. В PostgreSQL можно использовать `ROLLBACK`, если удаление было ошибочным (при условии, что ты в транзакции).
    
- `DELETE` не освобождает моментально место на диске — оно будет перераспределено или возвращено при `VACUUM`.
```
DELETE FROM "User";
```
## **Сортировка, группировка и фильтрация**

### **`ORDER BY`** — сортировка

Используется, чтобы отсортировать результат по одному или нескольким столбцам.
```
SELECT * FROM "User"
ORDER BY name ASC;  -- по алфавиту
```
Сортировка по убыванию:
```
SELECT * FROM "User"
ORDER BY id DESC;
```
- `ASC` (по возрастанию) — по умолчанию.
    
- `DESC` (по убыванию) — для обратной сортировки.
    
- Можно сортировать по номеру колонки: `ORDER BY 2 DESC`
    
- Поддерживается многоуровневая сортировка: `ORDER BY city ASC, name DESC`
### **`GROUP BY`** — группировка

Нужна, если ты хочешь объединить строки с одинаковыми значениями по определённому полю и применить агрегатные функции (`COUNT`, `SUM`, `AVG`, и т.д.).
```
SELECT phone_number, COUNT(*) 
FROM "User"
GROUP BY phone_number;
```
**Применение:**

- Анализ количества записей по категориям
    
- Расчёт средних/сумм по группам
    
- Получение топов (в связке с `ORDER BY` и `LIMIT`)
### **`HAVING`** — фильтр по сгруппированным данным

`WHERE` работает до группировки, а `HAVING` — после. Например, выберем только те номера, которые встречаются более одного раза:
```
SELECT phone_number, COUNT(*) 
FROM "User"
GROUP BY phone_number
HAVING COUNT(*) > 1;
```
### **`DISTINCT`** — убрать дубли

Позволяет исключить повторяющиеся строки:
```
SELECT DISTINCT phone_number 
FROM "User";
```
Можно использовать с несколькими колонками:
```
SELECT DISTINCT name, phone_number FROM "User";
```
Если две строки отличаются хотя бы по одному полю — они считаются разными.

## **Операторы условий**

### `AND` / `OR` — логические операторы

- `AND`: оба условия должны быть истинны
    
- `OR`: хотя бы одно условие должно быть истинным
```
SELECT * FROM "User"
WHERE name = 'Иван' AND phone_number IS NOT NULL;
```
### `IN` — включение в список

Позволяет указать список возможных значений вместо длинной цепочки `OR`:
```
SELECT * FROM "User"
WHERE name IN ('Иван', 'Мария', 'Сергей');
```
### `BETWEEN` — диапазон

Удобен для поиска по числовым или датам:
```
SELECT * FROM "User"
WHERE id BETWEEN 10 AND 20;
```
Работает **включительно**: 10 и 20 будут включены.

### `LIKE` — шаблон поиска

Позволяет найти строки по частичному совпадению:
```
SELECT * FROM "User"
WHERE name LIKE 'Анд%';  -- имена, начинающиеся на "Анд"
```
- `%` — любое количество символов
    
- `_` — один любой символ
### `IS NULL` / `IS NOT NULL` — проверка пустых значений

NULL — это "пустота", отсутствие значения. Проверка `= NULL` не сработает, нужно писать так:
```
SELECT * FROM "User"
WHERE phone_number IS NULL;
```

# Практическая часть
Таблица с данными для заданий
```
CREATE TABLE "User" (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    phone_number VARCHAR(20),
    age INT,
    city VARCHAR(100)
);
```
```
INSERT INTO "User" (name, phone_number, age, city) VALUES
('Антон', '89001234567', 34, 'Москва'),
('Анна', NULL, 22, 'Москва'),
('Мария', '89009876543', 19, 'Казань'),
('Иван', '88005553535', 45, 'Санкт-Петербург'),
('Ольга', NULL, 28, 'Казань'),
('Дмитрий', '89261231212', 17, 'Екатеринбург'),
('Мария', '89265554433', 23, 'Казань'),
('Сергей', '89993334411', 31, 'Новосибирск'),
('Анна', '89167778899', 25, 'Москва'),
('Ольга', '89009998877', 20, 'Москва'),
('Павел', NULL, 26, 'Новосибирск'),
('Иван', '89161231231', 24, 'Екатеринбург'),
('Ксения', '89273334455', 21, 'Казань'),
('Анна', '89008889900', 27, 'Москва');
```
### 1. Удалить всех пользователей, у которых номер телефона отсутствует.

### 2. Выбери все уникальные города, в которых есть пользователи.
### 3. Выбери всех пользователей старше 30 лет, отсортировав их по возрасту по убыванию.
### 4. Найди всех пользователей, чьи имена начинаются на "Ан".
### 5. Получить список городов и количество пользователей в каждом из них.
### 6. Выбери те города, в которых более 3 пользователей.
### 7. Удалить всех пользователей младше 18 лет.
### 8. Найти всех пользователей, у которых имя либо "Иван", либо "Мария", либо "Ольга".
### 9. Найди всех пользователей, возраст которых от 20 до 25 включительно и у которых указан номер телефона.
### 10. Выбери все имена пользователей без повторений.

