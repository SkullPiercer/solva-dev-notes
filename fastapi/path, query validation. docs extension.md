# Расширение документации в FastAPI

FastAPI вместе с **Swagger UI** позволяет не только автоматически генерировать документацию, но и делать её более понятной и структурированной для разработчиков. Можно группировать маршруты по смыслу, добавлять заголовки и описания, а также указывать, какие данные возвращаются.

---
## Группировка с помощью тегов

По умолчанию все эндпоинты отображаются в Swagger под тегом `default`. Чтобы разбить их на категории, в декоратор маршрута передаётся аргумент `tags`.

Например, разделим все маршруты на две группы:

- `authors` — методы, связанные с авторами
    
- `books` — методы, связанные с книгами
```
# library_api.py

from fastapi import FastAPI

app = FastAPI()

@app.get("/authors/me", tags=["authors"])
def get_my_profile():
    ...

@app.get("/books/{title}", tags=["books"])
def get_book_info(title: str):
    ...
```

В Swagger появятся два блока — `authors` и `books`.

Если один маршрут логически относится к нескольким группам, можно передать несколько тегов:
```
@app.get("/authors/{author_id}/books", tags=["authors", "books"])
def list_books_by_author(author_id: int):
    ...
```

Теперь метод будет отображаться и в разделе авторов, и в разделе книг.

---
## Задание понятных названий (summary)

Swagger по умолчанию подставляет имя функции как название. Например, функция `get_my_profile` превратится в `Get My Profile`.

Но можно задать более читаемое название при помощи аргумента `summary`:
```
@app.get("/authors/me", tags=["authors"], summary="Информация об авторе")
def get_my_profile():
    ...

@app.get("/books/{title}", tags=["books"], summary="Поиск книги по названию")
def get_book_info(title: str):
    ...
```

Теперь документация выглядит более осмысленно.

---
## Подробное описание (description и docstring)
Для развернутого описания есть два способа:

1. Передать аргумент `description` прямо в декораторе.
    
2. Или добавить докстринг к функции — в этом случае FastAPI автоматически возьмет его в документацию.

Пример с `description`:
```
@app.get(
    "/books/{title}",
    tags=["books"],
    summary="Поиск книги по названию",
    description="Возвращает описание книги по указанному названию. "
                "Дополнительно можно указать год издания и жанр."
)
def get_book_info(title: str, year: int | None = None, genre: str | None = None):
    ...
```

Пример с **докстрингом** и Markdown:
```
@app.get("/authors/{author_id}", tags=["authors"], summary="Данные об авторе")
def get_author(author_id: int):
    """
    Возвращает сведения об авторе:

    - **author_id**: уникальный идентификатор автора  
    - **name**: полное имя  
    - **birth_year**: год рождения (опционально)  
    - **main_genre**: основной жанр (опционально)  
    """
    ...
```

Swagger поддерживает Markdown, так что можно использовать списки, заголовки, выделение текста.

---
## Описание ответа (response_description)

По умолчанию для успешных запросов отображается текст `Successful Response`. Его можно заменить с помощью аргумента `response_description`:
```
@app.get(
    "/books/{title}",
    tags=["books"],
    summary="Поиск книги по названию",
    response_description="Подробная информация о найденной книге"
)
def get_book_info(title: str):
    ...
```

Теперь документация выглядит дружелюбнее и сразу даёт понять, что именно вернётся в ответе.

---
Таким образом, FastAPI позволяет превратить документацию из «сырого списка маршрутов» в удобный справочник: с группами, пояснениями, понятными названиями и структурой.

---
# Проверка и описание параметров в запросах
Когда клиент обращается к API библиотеки, он может передать что угодно: название книги длиной в тысячу символов или отрицательный год издания. Чтобы такие запросы не ломали приложение, используется **валидация входных данных**.

FastAPI автоматически проверяет типы: если вместо числа придёт строка, система вернёт ошибку. Но кроме типов можно накладывать и дополнительные ограничения — минимальная и максимальная длина строки, диапазон для чисел, проверка по регулярным выражениям.

---
## Path и Query

В FastAPI есть специальные инструменты для ограничения параметров: `Path` (для сегментов URL) и `Query` (для параметров после `?`). Оба импортируются из `fastapi`.

### Пример: ограничения на название книги и имя автора
```
# catalog_app.py

from fastapi import FastAPI, Path, Query
from typing import Optional

app = FastAPI()

@app.get(
    "/books/{title}",
    tags=["books"],
    summary="Поиск книги",
    response_description="Информация о книге"
)
def get_book(
    *,
    title: str = Path(..., min_length=2, max_length=60, description="Название книги"),
    author: str = Query(..., min_length=3, max_length=40, description="Фамилия автора"),
    year: Optional[int] = Query(None, ge=1500, le=2025, description="Год издания"),
    genre: Optional[str] = Query(None, regex="^[А-Яа-яЁё ]+$", description="Жанр (только кириллица)")
):
    return {
        "title": title,
        "author": author,
        "year": year,
        "genre": genre
    }
```

- `title` проверяется на длину (от 2 до 60 символов).
    
- `author` ограничен 3–40 символами.
    
- `year` должен попадать в диапазон 1500–2025.
    
- `genre` должен содержать только кириллические символы и пробелы.

Если ввести «Fantasy123» в поле жанра, Swagger даже не даст отправить такой запрос.

---
## Диапазоны чисел
Для числовых параметров можно указывать правила:

- `gt` — строго больше (greater than)
    
- `ge` — больше или равно
    
- `lt` — строго меньше
    
- `le` — меньше или равно

```
year: Optional[int] = Query(None, gt=1499, lt=2026)
```

Таким образом, книги из «будущего» или «древности» не пройдут проверку.

---
## Заголовки и описания параметров

Чтобы документация была понятнее, каждому параметру можно задать `title` и `description`:

```
title: str = Path(
    ..., 
    min_length=2, 
    max_length=60,
    title="Название книги", 
    description="Укажите полное название без сокращений"
)
```

В Swagger отобразится описание, а в ReDoc будет видно и заголовок, и описание.

---
## Псевдонимы (alias)
Иногда заказчик просит, чтобы параметры запроса выглядели определённым образом. Например, вместо `publish_year` — `publish-year`. В Python такое имя переменной использовать нельзя, но в `Query` можно задать псевдоним:
```
publish_year: int = Query(..., alias="publish-year")
```

Теперь запрос будет выглядеть так:
```
/books/Idiot?author=Достоевский&publish-year=1869
```

---
## Исключение параметров из документации

Если параметр должен работать, но не отображаться в Swagger, можно скрыть его через `include_in_schema=False`:
```
secret_code: Optional[str] = Query(
    None, include_in_schema=False
)
```

В таком случае только «посвящённые» смогут передать параметр вручную (например, через Postman).

---
## Передача списка значений

Книгу может написать не один автор. Чтобы передать список фамилий, достаточно аннотировать параметр как `list[str]`:
```
@app.get("/multi-authors", tags=["books"])
def get_by_authors(
    authors: list[str] = Query(..., min_length=2, max_length=40, description="Список авторов")
):
    return {"authors": authors}
```

В Swagger можно будет нажать «Add item» и указать несколько фамилий:
```
/multi-authors?authors=Толстой&authors=Тургенев
```

Ответ:
```
{
  "authors": ["Толстой", "Тургенев"]
}
```

Таким образом, FastAPI позволяет не только валидировать входные данные, но и красиво описывать параметры в документации. Это делает API библиотеки одновременно и защищённым, и удобным для использования.
